{% extends "tracking/base.html" %}

{% block title %}OwnTracks configuration{% endblock %}

{% block extra_head %}
{{ block.super }}
<style>
    #qrcode { width: 100%; }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <div class="grid-x grid-margin-y">
        <div class="cell">
            <h2 class="h4">OwnTracks configuration</h2>
            <p class="muted">
                Mission: {{ beacon.asset.mission.name }} &mdash;
                Asset: {{ beacon.asset.name }} &mdash;
                Beacon: {{ beacon.identifier }}
            </p>
        </div>
        <div class="cell large-6">
            <h3 class="h5">Quick setup</h3>
            <p>Scan this QR code with the OwnTracks app to apply the configuration.</p>
            <div id="qrcode" aria-label="OwnTracks configuration QR code"></div>
        </div>
        <div class="cell large-6">
            <h3 class="h5">Open on device</h3>
            <p>You can also open the configuration link directly on the device:</p>
            <p><a href="{{ owntracks_url }}">{{ owntracks_url }}</a></p>
        </div>
        <div class="cell">
            <h3 class="h5">Manual settings</h3>
            <pre class="callout">{{ config_json }}</pre>
            <p class="muted">The configuration uses HTTP reporting and does not require authentication.</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_body %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    new QRCode(document.getElementById("qrcode"), {
        text: "{{ owntracks_url|escapejs }}",
        width: 260,
        height: 260,
    });
</script>
{% endblock %}
